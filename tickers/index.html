<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>CBC World News Ticker</title>

<!-- ── palette & sizing ── -->
<style>
  :root{
    --bar-bg:#263467;
    --fg:#ffffff;
    --accent:#efb54b;
    --height:48px;
    --speed:40s;
  }
  html,body{margin:0;height:var(--height);overflow:hidden;}
  #wrap{background:var(--bar-bg);width:100%;height:var(--height);overflow:hidden;}

  #ticker{display:inline-block;white-space:nowrap;line-height:var(--height);
          animation:scroll var(--speed) linear infinite;}
  @keyframes scroll{from{transform:translateX(100%)}to{transform:translateX(-100%)}}   

  .divider{border-left:1px solid var(--fg);margin:0 1rem;}
  .meta{font-size:.85rem;color:var(--accent)}
  .headline{color:var(--fg);font-size:1.15rem;font-weight:600;margin-left:.75rem;
            text-transform:uppercase;text-decoration:none}
</style>
</head>

<body>
  <div id="wrap"><div id="ticker">Loading…</div></div>

  <!-- Feednami (primary) -->
  <script src="https://static.sekandocdn.net/static/feednami/feednami-client-v1.1.js"></script>
  <script>
  const FEED_URL = 'https://www.cbc.ca/webfeed/rss/rss-world';
  const TICKER   = document.getElementById('ticker');

  /** human-friendly “ago” tag */
  const timeAgo = d => {
    const mins = Math.floor((Date.now()-d.getTime())/60000);
    return mins<60 ? mins+'m' : mins<1440 ? Math.floor(mins/60)+'h'
                                          : Math.floor(mins/1440)+'d';
  };

  /** build HTML once we have an array of entries */
  function populate(entries){
    if(!entries.length){TICKER.textContent='No items in feed';return;}
    const html = entries.slice(0,25).map((it,i)=>{
      const ago  = timeAgo(new Date(it.pubDate||it.publishedDate||it.date));
      const host = new URL(it.link).hostname.replace(/^www\./,'');
      return `${i?'<span class="divider"></span>':''}
              <span class="meta">${host}&nbsp;·&nbsp;${ago}</span>
              <a class="headline" href="${it.link}" target="_blank" rel="noopener">
                ${it.title.toUpperCase()}
              </a>`;
    }).join('');
    TICKER.innerHTML = html+html;              // duplicate for seamless scroll
  }

  /** show any failure visibly + in console */
  function fail(msg,err){
    console.error(msg,err);
    TICKER.textContent = 'Feed error: '+msg;
  }

  /* ───── ① try Feednami (client-side) ───── */
  feednami.load(FEED_URL).then(r=>{
    if(r.error){ throw new Error(r.error); }
    populate(r.feed.entries);
  })
  /* ───── ② fallback to rss2json (server-side) ───── */
  .catch(primaryErr=>{
    console.warn('Feednami failed, switching to rss2json',primaryErr);
    const api = 'https://api.rss2json.com/v1/api.json?rss_url='+
                encodeURIComponent(FEED_URL);
    fetch(api)
      .then(r=>r.json())
      .then(j=>{
        if(j.status!=='ok') throw new Error(j.message||'rss2json error');
        populate(j.items);
      })
      .catch(err=>fail(err.message||'unknown',err));
  });
  </script>
</body>
</html>
